# 第2章 基本文法と4大命令

SQL文を書くための基本的なルールについて紹介します。

そしてデータを操作する4つの命令、SELECT、UPDATE、DELETE、INSERTについて全体を俯瞰したうえで、ここに詳しくみていきましょう。

<details><summary>2.1 SQLの基本ルール</summary>

### 2.1.1 記述形式に関するルール
- SQLに共通する基本ルール(1)
    - 文の途中に改行を入れることができる。
    - 行の先頭や行の途中に半角の空白を入れることができる。

    SQLは文の途中で改行することが許されています。また、行の先頭や行の途中に空白を入れることも可能です。これらのルールを活用して、読みやすく整形されたSQL文の記述を心がけましょう。

- 一行で記述されたSELECT文

    ```sql
    SELECT 費目, 出金額 FROM 家計簿 WHERE 出金額 > 3000
    ```

- 整形されたSELECT文

    ```sql
    SELECT 費目, 出金額
     FROM 家計簿
     WHERE 出金額 > 3000
    ```

- 末尾のセミコロンで文の終了を表す
    
    文中に改行を含むことができるSQLの特性は、わかりやすいSQL文を書くためにはとても重宝します。一方で、複数のSQL文を続けて記述する場合などには、どこの文に区切りがあるのかが分かりにくいというデメリットがあります。そこで、1つのSQL文の末尾にセミコロン記号(;)を付けることにより、文の区切りを明示することがあります。
    
    ```sql
    SELECT *
    FROM 家計簿; # ここまででSELECT文終了
    DELETE FROM 家計簿;# ここまででDELETE文終了
    ```

    本書では、複数のSQL文を1つのリストとして掲載する場合のみ、セミコロンを付けています。


### 2.1.2 コメントに関する2つのルール
    
コメントの記述方法には、次の2つのルールがあります

- SQLに共通する基本ルール(2)
    - ハイフン2つ(- -)から行末まではコメントになり、無視される。
    - /* から*/まではコメントになり、無視される。

    コメントを記述したSQL

    ```sql
    /* 入出金表示用SQL バージョン0.1
       作成者:朝香あゆみ 作成日:2018-02-01 */
    SELECT 入金額, 出金額  -- 金額関連の列のみ表示
      FROM 家計簿
    ```

    改行や空白による生計とコメントを併せて活用することにより、後で見た時や、チームで共有した時にわかりやすいSQL文の記述が可能になります。


### 2.1.3 予約語に関するルール
    
SQL文に記述できる語句についてのルール。

- SQLに共通する基本ルール(3)
    - SELECTやWHEREなどの命令に使う単語は、SQLとして特別な意味を持つ「予約語」である。
    - 予約語を記述する際は、大文字と小文字の区別はない。
    - テーブル名や列名に予約語を利用することはできない。
    
    SELECTやWHEREなどの一部の単語は、SQLの機能として特別な意味を持つため、列名などに使うことはできません。これを予約語(keyword)といいます。
    
    SQLの文中では、予約語を大文字と小文字のどちらで書いても同じ意味になります。たとえば、
    
    ```sql
    select * FROM 家計簿
    ```
    
    でも
    
    ```sql
    Select * froM 家計簿
    ```
    
    でも同じように動作しますが、できるだけ判別しやすい書き方にすることをお薦めします。すでに会社やプロジェクトでルールが定められていればそれに従うと良いでしょう。
    
    なお、列名やテーブル名について、大文字と小文字を区別するかどうかは、DBMS製品や動作するOS、設定などによって異なります。</details>


<details><summary>2.2 データ型とリテラル</summary>

### 2.2.1 リテラルの種類

-
    
    ```sql
    INSERT INTO 家計簿
    		 VALUES ('2018-02-25', '居住費', '3月の家賃', 0, 85000)
    ```
    
    2行目には家計簿テーブルの各列に格納する5つのデータが記述されています。SQL文の中に書き込まれたデータそのものを特にリテラル(literal)といいます。
    
- リテラルの記述に関するルール
    - 「'」で括らずに記述されたリテラルは、数値情報として扱われる。
    - 「’」で括られたリテラルは、基本的に文字列情報として扱われる。
    - 「'」で括られ、’2018-02-25’のような一定の形式で記述されたリテラルは、日付情報として扱われる。
        
        たとえば、「123」と「'123'」では意味が異なります。前者は123(ひゃくにじゅうさん)という数量を表す数値データ、後者は123(いち・に・さん)という3つの文字の並びを表す文字列データです。


### 2.2.2 列とデータ型

数値のデータを誤って文字列情報として指定してデータ形式で格納されないように、データベースには安全装置が備わっています。DBMSは、数値ではないとして処理を中断するか、受け取った文字列を強制的に数値に変換して格納しようとします。

データベースの中には複数のテーブルがあり、テーブルは行と列から成り立っています。それぞれの列には名前がついていますが、それに加えて、列ごとに格納できるデータの種類を表すデータ型(data type)を定めることになっています。
| データ型の設定 | DATE(日付) | VARCHAR(20)(可変長文字列、最大20バイト) | VARCHAR(80)(可変超文字列、最大80バイト) | INTEGER(整数) | INTEGER(整数) |
| --- | --- | --- | --- | --- | --- |
| 列名 | 日付 | 費目 | メモ | 入金額 | 出金額 |

たとえば、入金額と出金額の列にはあらかじめ「INTEGER」という数値のデータがが設定されているため、格納できるデータは数値のみとなっています。

代表的なデータ型
| データ種別 | 区分 | 代表的なデータ型名 |
| --- | --- | --- |
| 数値 | 整数値 | INTEGER型 |
| 数値 | 小数 | DECIMAL型、REAL型 |
| 文字列 | 固定長 | CHAR型 |
| 文字列 | 可変長 | VARCHAR型 |
| 日付と時刻 | — | DATETIME型、DATE型、TIME型 |

利用可能なデータ型はDBMS製品によって異なりますが、数値型、文字列型、日付型は基本的に必ず用意されています。特に、INTEGER型、CHAR型、VARCHAR型は、多くのDBMS製品で共通して利用することができます。

- データ型
    - テーブルの各列には、データ型が指定されている。
    - 列には、データ型で指定された種類の情報しか格納することはできない。
    - 利用可能なデータ型は、DBMS製品によって異なる。


### 2.2.3 固定長と可変長

CHAR型は固定長の文字列データを扱うデータ型です。たとえば、CHAR(10)と指定されている列では、あらかじめ10バイトの領域が確保されており、格納するデータは常に10バイトになります。格納しようとする文字列が10バイトに満たない場合は、文字列の右側に空白が追加され、10バイトぴったりに調整されてから格納されます。

一方、VARCHAR型を指定された列は、格納する文字列の長さを勝手に調整することはありません。たとえば、VARCHAR(10)と指定された列では、3バイトや7バイトの文字列が入力された場合、それに合わせた領域が確保されるため、そのままの長さで格納することが可能です。ただし、最大長として10が指定してあるため、11バイトの文字列は格納できません。

- CHAR型は郵便番号や社員番号など、格納するデータの桁数が決まっているもの。
- VARCHAR型は氏名や書籍名など、格納するデータの桁数が変動する可能性のあるもの。

に向いたデータ型と言えます。

- DBMSに依存しやすい日付の取り扱い
    
    日付の取り扱いに関しては、各DBMS製品間での違いが比較的大きい点に注意が必要です。主に、次のような点が異なっています。
    
    - 日付リテラルとしてどのような記述を許すか
    - 日付に関するデータ型の名前や制度
    - 日付に関して利用できる命令(関数)の種類</details>


<details><summary>2.3 SQLの命令体系</summary>

### 2.3.1 4つの重要なSQL文

ほとんどのデータ操作は、SELECT、UPDATE、DELETE、INSERTのたった4つの命令で実現できてしまいます。これら4つのSQL命令は、DML(Data Manipulation Language)と総称されています。

- SQLの言語体系
    - SQLでデータ処理を行うには、命令をたくさん覚える必要はない。
    - 4大命令だけで、ほとんどの処理を実現できる。
    
    4つの命令にさまざまな修飾語のようなものを付加することで非常な複雑なデータ操作を実現できることが、SQLという言語の特徴です。
    
    ```sql
    シンプルな命令→検索をお願いします。
    豊富な修飾語→「日付」と「出金額」だけでいい。ただ、今年の1月分だけが欲しくて。
    あと、日付が新しい順に並べ替えてくれる？
    
    --SQLだと
    SELECT 日付, 出金額
      FROM ...
     WHERE ...
    ORDER BY ...
    ```
    
- 2.3.2 4大命令の全体像を俯瞰する
    
    命令の数は少なくてシンプルだが、複雑に修飾できるというSQLの特徴が混乱させることも少なくありません。しかし、4つの命令の文法をスッキリとマスターするコツが3つあります。
    
    - 4大命令をスッキリと学ぶコツ(1)
        
        4大命令の構造と修飾語の全体像をしっかり把握する。
        
        | 命令 | 各命令で固有の部分 | 対象行の絞り込み | 検索結果の加工 |
        | --- | --- | --- | --- |
        | SELECT | 列名•••FROM テーブル名 | WHERE 〜 | その他修飾 |
        | UPDATE | テーブル名 SET 列名 = 値••• | WHERE 〜 |  |
        | DELETE | FROM テーブル名 | WHERE 〜 |  |
        | INSERT | INTO テーブル名 (列名•••) VALUES (値•••) |  |  |
</details>


<details><summary>2.4 SELECT文—データの検索</summary>


### 2.4.1 SELECT文の基本構文
    
データベースとデータのやり取りをするにあたって、最も頻繁に使われるSQLがSELECT文です。テーブルから目的のデータを指定して取得することがその役割です。

SELECT文の基本構文

```sql
SELECT 列名••• # SELECT:取得しなさい　列名:この列のデータを
  FROM テーブル名 # FROM テーブル名:このテーブルから
(WHERE修飾)
(その他の修飾)
```

1行目のSELECTの後ろには、取得したい列の名前をカンマで区切って記述します。また「＊」アスタリスクを記述すれば、すべての列を指定することができます。

2行目はFROM句といい、データを取得するテーブルを指定するために必ず指定します。

以降、必要に応じて、WHEREによる修飾やその他の修飾を続けて記述します。


### 2.4.2 ASによる別名の定義
    
SELECT文における列名やテーブル名の指定では、それぞれの記述の後ろに「AS + 任意のキーワード」を付けることで、別名を定義することができます。
```sql
SELECT 費目 AS ITEM, 入金額 AS RECEIVE, 出金額 AS PAY
  FROM 家計簿 AS MONEYBOOK
 WHERE 費目 = '給料'
```

- **別名をつけるメリット**
    - 結果表における列のタイトルを任意のものに変更できる。
    - わかりにくい列名や長い列名でも、わかりやすく短い別名をつけて利用することができる。
- **SELECT ＊ の濫用に御用心**
    
    *による全列検索は便利ですが、データベースの設計変更などで列が増えたり減ったりすると、検索結果も変化してしまいます。そのため、データベースを検索するアプリケーションプログラムでSELECT *を使用していた場合、予期しないバグの原因になることがあります。実際の開発では極力使用を避けるか、十分な検討が必要です。
