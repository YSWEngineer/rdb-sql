# 第2章 基本文法と4大命令

SQL文を書くための基本的なルールについて紹介します。

そしてデータを操作する4つの命令、SELECT、UPDATE、DELETE、INSERTについて全体を俯瞰したうえで、ここに詳しくみていきましょう。

<details><summary>2.1 SQLの基本ルール</summary>

### 2.1.1 記述形式に関するルール
- SQLに共通する基本ルール(1)
    - 文の途中に改行を入れることができる。
    - 行の先頭や行の途中に半角の空白を入れることができる。

    SQLは文の途中で改行することが許されています。また、行の先頭や行の途中に空白を入れることも可能です。これらのルールを活用して、読みやすく整形されたSQL文の記述を心がけましょう。

- 一行で記述されたSELECT文

    ```sql
    SELECT 費目, 出金額 FROM 家計簿 WHERE 出金額 > 3000
    ```

- 整形されたSELECT文

    ```sql
    SELECT 費目, 出金額
     FROM 家計簿
     WHERE 出金額 > 3000
    ```

- 末尾のセミコロンで文の終了を表す
    
    文中に改行を含むことができるSQLの特性は、わかりやすいSQL文を書くためにはとても重宝します。一方で、複数のSQL文を続けて記述する場合などには、どこの文に区切りがあるのかが分かりにくいというデメリットがあります。そこで、1つのSQL文の末尾にセミコロン記号(;)を付けることにより、文の区切りを明示することがあります。
    
    ```sql
    SELECT *
    FROM 家計簿; # ここまででSELECT文終了
    DELETE FROM 家計簿;# ここまででDELETE文終了
    ```

    本書では、複数のSQL文を1つのリストとして掲載する場合のみ、セミコロンを付けています。


### 2.1.2 コメントに関する2つのルール
    
コメントの記述方法には、次の2つのルールがあります

- SQLに共通する基本ルール(2)
    - ハイフン2つ(- -)から行末まではコメントになり、無視される。
    - /* から*/まではコメントになり、無視される。

    コメントを記述したSQL

    ```sql
    /* 入出金表示用SQL バージョン0.1
       作成者:朝香あゆみ 作成日:2018-02-01 */
    SELECT 入金額, 出金額  -- 金額関連の列のみ表示
      FROM 家計簿
    ```

    改行や空白による生計とコメントを併せて活用することにより、後で見た時や、チームで共有した時にわかりやすいSQL文の記述が可能になります。


### 2.1.3 予約語に関するルール
    
SQL文に記述できる語句についてのルール。

- SQLに共通する基本ルール(3)
    - SELECTやWHEREなどの命令に使う単語は、SQLとして特別な意味を持つ「予約語」である。
    - 予約語を記述する際は、大文字と小文字の区別はない。
    - テーブル名や列名に予約語を利用することはできない。
    
    SELECTやWHEREなどの一部の単語は、SQLの機能として特別な意味を持つため、列名などに使うことはできません。これを予約語(keyword)といいます。
    
    SQLの文中では、予約語を大文字と小文字のどちらで書いても同じ意味になります。たとえば、
    
    ```sql
    select * FROM 家計簿
    ```
    
    でも
    
    ```sql
    Select * froM 家計簿
    ```
    
    でも同じように動作しますが、できるだけ判別しやすい書き方にすることをお薦めします。すでに会社やプロジェクトでルールが定められていればそれに従うと良いでしょう。
    
    なお、列名やテーブル名について、大文字と小文字を区別するかどうかは、DBMS製品や動作するOS、設定などによって異なります。</details>


<details><summary>2.2 データ型とリテラル</summary>

### 2.2.1 リテラルの種類

-
    
    ```sql
    INSERT INTO 家計簿
    		 VALUES ('2018-02-25', '居住費', '3月の家賃', 0, 85000)
    ```
    
    2行目には家計簿テーブルの各列に格納する5つのデータが記述されています。SQL文の中に書き込まれたデータそのものを特にリテラル(literal)といいます。
    
- リテラルの記述に関するルール
    - 「'」で括らずに記述されたリテラルは、数値情報として扱われる。
    - 「’」で括られたリテラルは、基本的に文字列情報として扱われる。
    - 「'」で括られ、’2018-02-25’のような一定の形式で記述されたリテラルは、日付情報として扱われる。
        
        たとえば、「123」と「'123'」では意味が異なります。前者は123(ひゃくにじゅうさん)という数量を表す数値データ、後者は123(いち・に・さん)という3つの文字の並びを表す文字列データです。


### 2.2.2 列とデータ型

数値のデータを誤って文字列情報として指定してデータ形式で格納されないように、データベースには安全装置が備わっています。DBMSは、数値ではないとして処理を中断するか、受け取った文字列を強制的に数値に変換して格納しようとします。

データベースの中には複数のテーブルがあり、テーブルは行と列から成り立っています。それぞれの列には名前がついていますが、それに加えて、列ごとに格納できるデータの種類を表すデータ型(data type)を定めることになっています。
| データ型の設定 | DATE(日付) | VARCHAR(20)(可変長文字列、最大20バイト) | VARCHAR(80)(可変超文字列、最大80バイト) | INTEGER(整数) | INTEGER(整数) |
| --- | --- | --- | --- | --- | --- |
| 列名 | 日付 | 費目 | メモ | 入金額 | 出金額 |

たとえば、入金額と出金額の列にはあらかじめ「INTEGER」という数値のデータがが設定されているため、格納できるデータは数値のみとなっています。

代表的なデータ型
| データ種別 | 区分 | 代表的なデータ型名 |
| --- | --- | --- |
| 数値 | 整数値 | INTEGER型 |
| 数値 | 小数 | DECIMAL型、REAL型 |
| 文字列 | 固定長 | CHAR型 |
| 文字列 | 可変長 | VARCHAR型 |
| 日付と時刻 | — | DATETIME型、DATE型、TIME型 |

利用可能なデータ型はDBMS製品によって異なりますが、数値型、文字列型、日付型は基本的に必ず用意されています。特に、INTEGER型、CHAR型、VARCHAR型は、多くのDBMS製品で共通して利用することができます。

- データ型
    - テーブルの各列には、データ型が指定されている。
    - 列には、データ型で指定された種類の情報しか格納することはできない。
    - 利用可能なデータ型は、DBMS製品によって異なる。


### 2.2.3 固定長と可変長

CHAR型は固定長の文字列データを扱うデータ型です。たとえば、CHAR(10)と指定されている列では、あらかじめ10バイトの領域が確保されており、格納するデータは常に10バイトになります。格納しようとする文字列が10バイトに満たない場合は、文字列の右側に空白が追加され、10バイトぴったりに調整されてから格納されます。

一方、VARCHAR型を指定された列は、格納する文字列の長さを勝手に調整することはありません。たとえば、VARCHAR(10)と指定された列では、3バイトや7バイトの文字列が入力された場合、それに合わせた領域が確保されるため、そのままの長さで格納することが可能です。ただし、最大長として10が指定してあるため、11バイトの文字列は格納できません。

- CHAR型は郵便番号や社員番号など、格納するデータの桁数が決まっているもの。
- VARCHAR型は氏名や書籍名など、格納するデータの桁数が変動する可能性のあるもの。

に向いたデータ型と言えます。

- DBMSに依存しやすい日付の取り扱い
    
    日付の取り扱いに関しては、各DBMS製品間での違いが比較的大きい点に注意が必要です。主に、次のような点が異なっています。
    
    - 日付リテラルとしてどのような記述を許すか
    - 日付に関するデータ型の名前や制度
    - 日付に関して利用できる命令(関数)の種類
